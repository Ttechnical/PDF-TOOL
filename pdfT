#!/bin/python
import base64
exec(base64.b64decode('ZnJvbSBmcGRmIGltcG9ydCBGUERGCmltcG9ydCBQeVBERjIKaW1wb3J0IG9zCmltcG9ydCBzdWJwcm9jZXNzCgpkZWYgbWFpbigpOgogICAgcHJpbnQoIldlbGNvbWUgdG8gUERGLVRPT0whIFxuXDAzM1s5NW1QbGVhc2Ugc2VsZWN0IGFuIG9wdGlvbjpcMDMzWzBtIikKICAgIHByaW50KCJcMDMzWzkzbTEuUERGIE1ha2VyIikKICAgIHByaW50KCIyLlBERiBMb2NrZXIiKQogICAgcHJpbnQoIjMuUERGIEJydXRlIEZvcmNlIikKICAgIGNob2ljZSA9IGlucHV0KCJcMDMzWzkybUVudGVyIHlvdXIgY2hvaWNlOlwwMzNbMG0gIikKCiAgICBpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICMgUERGIE1ha2VyIGZ1bmN0aW9uYWxpdHkKICAgICAgICBvcy5zeXN0ZW0oImNsZWFyIikKICAgICAgICBvcy5zeXN0ZW0oImZpZ2xldCBQREZtYWtlciB8IGxvbGNhdCIpCiAgICAgICAgZnJvbSBmcGRmIGltcG9ydCBGUERGCiAgICAgICAgZGVmIGNyZWF0ZV9wZGYoKToKICAgICAgICAgICAgZmlsZXNfaW5wdXQgPSBpbnB1dCgiRW50ZXIgdGhlIGZpbGVzIChpbWFnZXMgYW5kIHR4dCBmaWxlcyk6ICIpLnNwbGl0KCkKICAgICAgICAgICAgb3V0cHV0X3BkZiA9IGlucHV0KCJFbnRlciB0aGUgbmFtZSBvZiB0aGUgb3V0cHV0IFBERiBmaWxlOiAiKQoKICAgICAgICAgICAgcGRmID0gRlBERigpCiAgICAgICAgICAgIHBkZi5zZXRfYXV0b19wYWdlX2JyZWFrKGF1dG89VHJ1ZSwgbWFyZ2luPTE1KQoKICAgICAgICAgICAgaW1hZ2VfZmlsZXMgPSBbXQogICAgICAgICAgICB0ZXh0X2ZpbGVzID0gW10KICAgICAgICAgICAgZm9yIGZpbGUgaW4gZmlsZXNfaW5wdXQ6CiAgICAgICAgICAgICAgICBpZiBmaWxlLmxvd2VyKCkuZW5kc3dpdGgoKCcucG5nJywgJy5qcGcnLCAnLmpwZWcnKSkgYW5kIG9zLnBhdGguaXNmaWxlKGZpbGUpOgogICAgICAgICAgICAgICAgICAgIGltYWdlX2ZpbGVzLmFwcGVuZChmaWxlKQogICAgICAgICAgICAgICAgZWxpZiBmaWxlLmxvd2VyKCkuZW5kc3dpdGgoJy50eHQnKSBhbmQgb3MucGF0aC5pc2ZpbGUoZmlsZSk6CiAgICAgICAgICAgICAgICAgICAgdGV4dF9maWxlcy5hcHBlbmQoZmlsZSkKCiAgICAgICAgICAgICMgQWRkIGZpbGVzIGluIHRoZSBvcmRlciB0aGV5IHdlcmUgcHJvdmlkZWQKICAgICAgICAgICAgZm9yIGZpbGUgaW4gZmlsZXNfaW5wdXQ6CiAgICAgICAgICAgICAgICBpZiBmaWxlIGluIGltYWdlX2ZpbGVzOgogICAgICAgICAgICAgICAgICAgIHBkZi5hZGRfcGFnZSgpCiAgICAgICAgICAgICAgICAgICAgcGRmLnNldF9mb250KCJBcmlhbCIsIHNpemU9MTIpCiAgICAgICAgICAgICAgICAgICAgcGRmLmNlbGwoMjAwLCAxMCwgbG49VHJ1ZSwgYWxpZ249IkMiKQogICAgICAgICAgICAgICAgICAgIHBkZi5pbWFnZShmaWxlLCB4PTEwLCB5PTIwLCB3PTE4MCkKICAgICAgICAgICAgICAgIGVsaWYgZmlsZSBpbiB0ZXh0X2ZpbGVzOgogICAgICAgICAgICAgICAgICAgIHBkZi5hZGRfcGFnZSgpCiAgICAgICAgICAgICAgICAgICAgcGRmLnNldF9mb250KCJBcmlhbCIsIHNpemU9MTIpCiAgICAgICAgICAgICAgICAgICAgcGRmLmNlbGwoMjAwLCAxMCwgbG49VHJ1ZSwgYWxpZ249IkMiKQogICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gZi5yZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgcGRmLm11bHRpX2NlbGwoMCwgMTAsIHR4dD1jb250ZW50LmRlY29kZSgidXRmLTgiKSkKCiAgICAgICAgICAgIHBkZi5vdXRwdXQob3V0cHV0X3BkZikKICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUob3V0cHV0X3BkZik6CiAgICAgICAgICAgICAgICBwcmludCgiUERGIGZpbGUgc3VjY2Vzc2Z1bGx5IGNyZWF0ZWQiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlBERiBmaWxlIGNyZWF0aW9uIGZhaWxlZCIpCgogICAgICAgIGNyZWF0ZV9wZGYoKQoKICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAjIFBERiBMb2NrZXIgZnVuY3Rpb25hbGl0eQogICAgICAgIG9zLnN5c3RlbSgiY2xlYXIiKQogICAgICAgIG9zLnN5c3RlbSgiZmlnbGV0IFBERkxvY2tlZCB8IGxvbGNhdCIpCiAgICAgICAgaW1wb3J0IFB5UERGMgogICAgICAgIGRlZiBwcm90ZWN0X3BkZihpbnB1dF9wZGY9Tm9uZSwgb3V0cHV0X3BkZj1Ob25lLCBwYXNzd29yZD1Ob25lKToKICAgICAgICAgICAgaWYgbm90IGlucHV0X3BkZjoKICAgICAgICAgICAgICAgIGlucHV0X3BkZiA9IGlucHV0KCJDaG9vc2UgdGhlIFBERiBmaWxlOiAiKQogICAgICAgICAgICBpZiBub3Qgb3V0cHV0X3BkZjoKICAgICAgICAgICAgICAgIG91dHB1dF9wZGYgPSBpbnB1dCgiRW50ZXIgdGhlIG5hbWUgZm9yIHRoZSBvdXRwdXQgUERGIGZpbGU6ICIpCiAgICAgICAgICAgIGlmIG5vdCBwYXNzd29yZDoKICAgICAgICAgICAgICAgIHBhc3N3b3JkID0gaW5wdXQoIkVudGVyIHRoZSBwYXNzd29yZCB0byBwcm90ZWN0IHRoZSBQREY6ICIpCgogICAgICAgICAgICB3aXRoIG9wZW4oaW5wdXRfcGRmLCAncmInKSBhcyBmaWxlOgogICAgICAgICAgICAgICAgcGRmID0gUHlQREYyLlBkZlJlYWRlcihmaWxlKQogICAgICAgICAgICAgICAgd3JpdGVyID0gUHlQREYyLlBkZldyaXRlcigpCgogICAgICAgICAgICAgICAgZm9yIHBhZ2VfbnVtIGluIHJhbmdlKGxlbihwZGYucGFnZXMpKToKICAgICAgICAgICAgICAgICAgICBwYWdlID0gcGRmLnBhZ2VzW3BhZ2VfbnVtXQogICAgICAgICAgICAgICAgICAgIHdyaXRlci5hZGRfcGFnZShwYWdlKQoKICAgICAgICAgICAgICAgIHdyaXRlci5lbmNyeXB0KHBhc3N3b3JkKQoKICAgICAgICAgICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGRmLCAnd2InKSBhcyBvdXRwdXQ6CiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLndyaXRlKG91dHB1dCkKCiAgICAgICAgICAgIHByaW50KCJZb3VyIFBERiBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgcGFzc3dvcmQgcHJvdGVjdGVkISDwn5SSIikKCiAgICAgICAgcHJvdGVjdF9wZGYoKQoKICAgIGVsaWYgY2hvaWNlID09ICIzIjoKICAgICAgICAjIFBERiBCcnV0ZSBGb3JjZSBmdW5jdGlvbmFsaXR5CiAgICAgICAgb3Muc3lzdGVtKCJjbGVhciIpCiAgICAgICAgb3Muc3lzdGVtKCJmaWdsZXQgUERGYnJ1dGUgfCBsb2xjYXQiKQogICAgICAgIGltcG9ydCBQeVBERjQKICAgICAgICBkZWYgYnJ1dGVfZm9yY2VfYXR0YWNrKHBkZl9maWxlLCBwYXNzd29yZF9saXN0KToKICAgICAgICAgICAgd2l0aCBvcGVuKHBkZl9maWxlLCAncmInKSBhcyBmaWxlOgogICAgICAgICAgICAgICAgcGRmX3JlYWRlciA9IFB5UERGNC5QZGZGaWxlUmVhZGVyKGZpbGUpCgogICAgICAgICAgICAgICAgZm9yIHBhc3N3b3JkIGluIHBhc3N3b3JkX2xpc3Q6CiAgICAgICAgICAgICAgICAgICAgaWYgcGRmX3JlYWRlci5kZWNyeXB0KHBhc3N3b3JkKSA9PSAxOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiXDAzM1s5M21QYXNzd29yZCBmb3VuZCwgWW91ciBwYXNzd29yZCBpc/CfkYk6IiwgcGFzc3dvcmQsICJcMDMzWzBtIikgICMgSGlnaGxpZ2h0ZWQgdGV4dAogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgiUGFzc3dvcmQgZmFpbGVkOiIsIHBhc3N3b3JkKQoKICAgICAgICAgICAgcHJpbnQoIlwwMzNbOTNtUGFzc3dvcmQgbm90IGZvdW5kLiIpCgogICAgICAgIHBkZl9maWxlID0gaW5wdXQoIkNob29zZSBQREYgZmlsZTogIikKICAgICAgICBwYXNzd29yZF9maWxlX3BhdGggPSBpbnB1dCgiRW50ZXIgdGhlIHBhc3N3b3JkIGxpc3QodHh0KTogIikKICAgICAgICB3aXRoIG9wZW4ocGFzc3dvcmRfZmlsZV9wYXRoLCAncicpIGFzIGZpbGU6CiAgICAgICAgICAgIHBhc3N3b3JkX2xpc3QgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGVdCgogICAgICAgIGJydXRlX2ZvcmNlX2F0dGFjayhwZGZfZmlsZSwgcGFzc3dvcmRfbGlzdCkKCiAgICBlbHNlOgogICAgICAgIHByaW50KCJJbnZhbGlkIGNob2ljZS4gUGxlYXNlIGVudGVyIDEsIDIsIG9yIDMuIikKCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICAjIEV4ZWN1dGUgdGhlIGNvbW1hbmQgYW5kIGNsZWFyIHRoZSB0ZXJtaW5hbAogICAgb3Muc3lzdGVtKCdjbGVhcicpCiAgICBzdWJwcm9jZXNzLnJ1bigiZmlnbGV0IFBERi1UT09MIHwgbG9sY2F0Iiwgc2hlbGw9VHJ1ZSkKICAgIG1haW4oKQo=').decode())
